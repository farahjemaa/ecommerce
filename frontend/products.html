<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produits | √âL√âGANCE</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="grain-overlay"></div>
    
    <!-- NAVIGATION -->
    <header class="header">
        <nav class="nav">
            <a href="index.html" class="logo">
                <span class="logo-icon">‚óÜ</span>
                <span class="logo-text">√âL√âGANCE</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">Accueil</a></li>
                <li><a href="products.html" class="active">Produits</a></li>
                <li><a href="#" onclick="openAdminLogin(event)">Admin</a></li>
            </ul>
            <div class="nav-actions">
                <!-- Theme Toggle -->
                <button class="theme-toggle" onclick="toggleTheme()" title="Changer le th√®me">
                    <div class="theme-toggle-icons">
                        <span class="icon-moon">üåô</span>
                        <span class="icon-sun">‚òÄÔ∏è</span>
                    </div>
                    <span class="theme-toggle-slider"></span>
                </button>
                
                <a href="cart.html" class="cart-btn" id="cartBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
            </div>
        </nav>
    </header>

    <main class="page-content">
        <!-- PAGE HEADER -->
        <section class="page-header">
            <div class="container">
                <nav class="breadcrumb">
                    <a href="index.html">Accueil</a>
                    <span>/</span>
                    <span>Produits</span>
                </nav>
                <h1 class="page-title">Nos Produits</h1>
                <p class="page-subtitle">D√©couvrez notre collection compl√®te - Prix en Dinars Tunisiens</p>
            </div>
        </section>

        <!-- PRODUCTS SECTION -->
        <section class="products-page-section">
            <div class="container">
                <div class="products-layout">
                    <!-- SIDEBAR FILTERS -->
                    <aside class="filters-sidebar">
                        <div class="filter-section">
                            <h3 class="filter-title">Cat√©gories</h3>
                            <ul class="filter-list" id="categoryFilters">
                                <li>
                                    <label class="filter-checkbox">
                                        <input type="radio" name="category" value="" checked>
                                        <span class="checkmark"></span>
                                        <span>Toutes les cat√©gories</span>
                                    </label>
                                </li>
                                <li>
                                    <label class="filter-checkbox">
                                        <input type="radio" name="category" value="smartphones">
                                        <span class="checkmark"></span>
                                        <span>üì± Smartphones</span>
                                    </label>
                                </li>
                                <li>
                                    <label class="filter-checkbox">
                                        <input type="radio" name="category" value="ordinateurs">
                                        <span class="checkmark"></span>
                                        <span>üíª Ordinateurs</span>
                                    </label>
                                </li>
                                <li>
                                    <label class="filter-checkbox">
                                        <input type="radio" name="category" value="audio">
                                        <span class="checkmark"></span>
                                        <span>üéß Audio</span>
                                    </label>
                                </li>
                                <li>
                                    <label class="filter-checkbox">
                                        <input type="radio" name="category" value="wearables">
                                        <span class="checkmark"></span>
                                        <span>‚åö Wearables</span>
                                    </label>
                                </li>
                                <li>
                                    <label class="filter-checkbox">
                                        <input type="radio" name="category" value="gaming">
                                        <span class="checkmark"></span>
                                        <span>üéÆ Gaming</span>
                                    </label>
                                </li>
                                <li>
                                    <label class="filter-checkbox">
                                        <input type="radio" name="category" value="photo">
                                        <span class="checkmark"></span>
                                        <span>üì∑ Photo & Vid√©o</span>
                                    </label>
                                </li>
                            </ul>
                        </div>

                        <div class="filter-section">
                            <h3 class="filter-title">Prix (TND)</h3>
                            <div class="price-range">
                                <div class="price-inputs">
                                    <div class="price-input-group">
                                        <label>Min</label>
                                        <input type="number" id="priceMin" placeholder="0" min="0">
                                    </div>
                                    <span class="price-separator">-</span>
                                    <div class="price-input-group">
                                        <label>Max</label>
                                        <input type="number" id="priceMax" placeholder="10000" min="0">
                                    </div>
                                </div>
                                <input type="range" id="priceRange" min="0" max="10000" value="10000" step="100" class="price-slider">
                                <div class="price-range-labels">
                                    <span>0 TND</span>
                                    <span>10 000 TND</span>
                                </div>
                            </div>
                        </div>

                        <div class="filter-section">
                            <h3 class="filter-title">Disponibilit√©</h3>
                            <ul class="filter-list">
                                <li>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" id="inStockOnly">
                                        <span class="checkmark"></span>
                                        <span>En stock uniquement</span>
                                    </label>
                                </li>
                            </ul>
                        </div>

                        <button class="btn btn-primary btn-full" onclick="applyFilters()">
                            Appliquer les filtres
                        </button>
                        <button class="btn btn-outline btn-full" onclick="resetFilters()" style="margin-top: 10px;">
                            R√©initialiser
                        </button>
                    </aside>

                    <!-- PRODUCTS GRID -->
                    <div class="products-main">
                        <div class="products-toolbar">
                            <div class="products-count">
                                <span id="productsCount">0</span> produits trouv√©s
                            </div>
                            <div class="products-sort">
                                <label for="sortSelect">Trier par:</label>
                                <select id="sortSelect" onchange="sortProducts()">
                                    <option value="newest">Plus r√©cents</option>
                                    <option value="price-asc">Prix croissant</option>
                                    <option value="price-desc">Prix d√©croissant</option>
                                    <option value="name">Nom A-Z</option>
                                </select>
                            </div>
                        </div>

                        <div class="products-grid" id="productsGrid">
                            <div class="loading-state">
                                <div class="loader"></div>
                                <p>Chargement des produits...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2025 √âL√âGANCE. Tous droits r√©serv√©s.</p>
            </div>
        </div>
    </footer>

    <!-- NOTIFICATION -->
    <div id="notification" class="notification"></div>

    <!-- ADMIN LOGIN MODAL -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîê Acc√®s Administration</h2>
                <button class="modal-close" onclick="closeAdminLogin()">√ó</button>
            </div>
            <div class="modal-body">
                <p style="text-align: center; color: var(--color-text-secondary); margin-bottom: 1.5rem;">
                    Veuillez entrer le mot de passe pour acc√©der au panneau d'administration.
                </p>
                <form onsubmit="return checkAdminPassword(event)" class="login-form" style="max-width: 300px; margin: 0 auto;">
                    <input type="password" id="adminPasswordInput" placeholder="Mot de passe" autocomplete="off">
                    <button type="submit" class="btn btn-primary btn-full">
                        üîì Acc√©der
                    </button>
                    <p id="loginErrorMsg" class="login-error">‚ùå Mot de passe incorrect</p>
                </form>
                <p style="text-align: center; color: var(--color-text-muted); font-size: 0.8rem; margin-top: 1.5rem;">
                    üí° Indice: <strong>admin123</strong>
                </p>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        let allProducts = [];
        let filteredProducts = [];

        // Mapping des produits par cat√©gorie bas√© sur le nom
        const categoryKeywords = {
            'smartphones': ['iphone', 'samsung', 'galaxy', 'smartphone', 'phone', 'mobile'],
            'ordinateurs': ['macbook', 'laptop', 'ordinateur', 'pc', 'computer', 'ipad', 'tablette'],
            'audio': ['airpods', '√©couteurs', 'casque', 'enceinte', 'sony wh', 'audio', 'speaker'],
            'wearables': ['watch', 'montre', 'apple watch', 'smartwatch', 'bracelet'],
            'gaming': ['playstation', 'nintendo', 'xbox', 'switch', 'gaming', 'ps5', 'console'],
            'photo': ['canon', 'camera', 'cam√©ra', 'drone', 'dji', 'webcam', 'photo', 'vid√©o']
        };

        // Fonction pour d√©terminer la cat√©gorie d'un produit
        function getProductCategory(product) {
            const productName = product.name.toLowerCase();
            const productDesc = (product.description || '').toLowerCase();
            
            for (const [category, keywords] of Object.entries(categoryKeywords)) {
                for (const keyword of keywords) {
                    if (productName.includes(keyword) || productDesc.includes(keyword)) {
                        return category;
                    }
                }
            }
            return 'autres';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await loadAllProducts();
            updateCartCount();
            
            // V√©rifier les param√®tres URL pour le filtre cat√©gorie
            const urlParams = new URLSearchParams(window.location.search);
            const categoryParam = urlParams.get('category');
            if (categoryParam) {
                const radio = document.querySelector(`input[name="category"][value="${categoryParam}"]`);
                if (radio) {
                    radio.checked = true;
                    applyFilters();
                }
            }

            // √âv√©nements pour les filtres
            document.getElementById('priceRange').addEventListener('input', function() {
                document.getElementById('priceMax').value = this.value;
            });

            // Appliquer filtres automatiquement quand on change la cat√©gorie
            document.querySelectorAll('input[name="category"]').forEach(radio => {
                radio.addEventListener('change', applyFilters);
            });
        });

        async function loadAllProducts() {
            const container = document.getElementById('productsGrid');
            try {
                allProducts = await API.getProducts();
                filteredProducts = [...allProducts];
                renderProducts();
            } catch (error) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ö†Ô∏è</div>
                        <h3>Erreur de connexion</h3>
                        <p>Impossible de charger les produits.</p>
                    </div>
                `;
            }
        }

        function renderProducts() {
            const container = document.getElementById('productsGrid');
            const countEl = document.getElementById('productsCount');
            
            countEl.textContent = filteredProducts.length;
            
            if (filteredProducts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <h3>Aucun produit trouv√©</h3>
                        <p>Essayez de modifier vos filtres.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredProducts.map(product => createProductCard(product)).join('');
        }

        function applyFilters() {
            const categoryValue = document.querySelector('input[name="category"]:checked')?.value;
            const priceMin = parseFloat(document.getElementById('priceMin').value) || 0;
            const priceMax = parseFloat(document.getElementById('priceMax').value) || Infinity;
            const inStockOnly = document.getElementById('inStockOnly').checked;

            filteredProducts = allProducts.filter(product => {
                // Filtre cat√©gorie bas√© sur les mots-cl√©s
                if (categoryValue) {
                    const productCategory = getProductCategory(product);
                    if (productCategory !== categoryValue) return false;
                }
                
                // Filtre prix
                const price = parseFloat(product.price);
                if (price < priceMin || price > priceMax) return false;
                
                // Filtre stock
                if (inStockOnly && product.stock <= 0) return false;
                
                return true;
            });

            sortProducts();
        }

        function resetFilters() {
            document.querySelector('input[name="category"][value=""]').checked = true;
            document.getElementById('priceMin').value = '';
            document.getElementById('priceMax').value = '';
            document.getElementById('priceRange').value = 10000;
            document.getElementById('inStockOnly').checked = false;
            
            filteredProducts = [...allProducts];
            renderProducts();
        }

        function sortProducts() {
            const sortValue = document.getElementById('sortSelect').value;
            
            switch (sortValue) {
                case 'price-asc':
                    filteredProducts.sort((a, b) => parseFloat(a.price) - parseFloat(b.price));
                    break;
                case 'price-desc':
                    filteredProducts.sort((a, b) => parseFloat(b.price) - parseFloat(a.price));
                    break;
                case 'name':
                    filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'newest':
                default:
                    filteredProducts.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
            }
            
            renderProducts();
        }

        // === ADMIN LOGIN FUNCTIONS ===
        const ADMIN_PASSWORD = 'admin123';

        function openAdminLogin(e) {
            e.preventDefault();
            document.getElementById('adminLoginModal').classList.add('show');
            document.getElementById('adminPasswordInput').value = '';
            document.getElementById('adminPasswordInput').focus();
            document.getElementById('loginErrorMsg').classList.remove('show');
        }

        function closeAdminLogin() {
            document.getElementById('adminLoginModal').classList.remove('show');
        }

        function checkAdminPassword(e) {
            e.preventDefault();
            const password = document.getElementById('adminPasswordInput').value;
            const errorEl = document.getElementById('loginErrorMsg');
            
            if (password === ADMIN_PASSWORD) {
                sessionStorage.setItem('adminAuthenticated', 'true');
                window.location.href = 'admin.html';
            } else {
                errorEl.classList.add('show');
                document.getElementById('adminPasswordInput').value = '';
                document.getElementById('adminPasswordInput').focus();
                setTimeout(() => errorEl.classList.remove('show'), 3000);
            }
            return false;
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeAdminLogin();
        });
    </script>
</body>
</html>

